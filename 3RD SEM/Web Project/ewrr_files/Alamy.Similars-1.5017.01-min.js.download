var freeImageContribType={None:0,Type1:1,Type2:2},imageThumbType={SimilarImages:0,SamePhotographerImages:1,HybridImages:2,SameArtistImages:3},isNextHybridPageExists=!0;function InitSimilars(e,t){var i=new similarsViewModel;switch(e){case imageThumbType.SamePhotographerImages:ko.applyBindings(i,document.getElementById("DivSimilarsImages"));break;case imageThumbType.SimilarImages:ko.applyBindings(i,document.getElementById("DivSamePhotographerImages"));break;case imageThumbType.SameArtistImages:ko.applyBindings(i,document.getElementById("DivSameArtistImages"));break;default:t==freeImageContribType.Type2?ko.applyBindings(i,document.getElementById("DivSimilarFreeImages")):isFreeImageComp?isBotRequest||ko.applyBindings(i,document.getElementById("DivHybridImagesOnFreeComp")):ko.applyBindings(i,document.getElementById("DivHybridImages"))}i.GetSimilars(e,t)}var SEOType={Type1:0,Normal:1},getSEOType=function(e){var t=SEOType.Normal,i=JSON.parse(seoExperiments);if(i&&0<i.length)for(var r=0;r<i.length;r++)if(e>=i[r].StartSeq&&e<=i[r].EndSeq){t=i[r].SEOType;break}return t},getTruncateStatus=function(e){var t=0,i=JSON.parse(seoExperiments);if(i&&0<i.length)for(var r=0;r<i.length;r++)if(e>=i[r].StartSeq&&e<=i[r].EndSeq){t=i[r].TruncateStatus;break}return t},similarsViewModel=function(){var y=this;y.thumbs=ko.observableArray(),y.freeThumbs=ko.observableArray(),y.isScrollDisabled=ko.observable(!1),y.PageNumber=1,y.viewAllUrl=ko.observableArray([]),y.thumbType,y.AllImageCount=0,y.AllFreeImageCount=0,y.freeImageContributorType=0,y.getTitle=function(e,t){return e+" - "+ClientResources.StockImage+" - "+t},y.getAltText=function(e){return" -"+ClientResources.StockImage+"- "+e+"\\"},y.getMB=function(e){return getHybridMarginBottom(e.PixelX,e.PixelY,e.Height())+"px"},y.renderedHandler=function(e,t){y.thumbs.indexOf(t)==y.thumbs().length-1&&$(".imagepopup img").hover(function(){$(this).imgPopup()},function(){$(this).unPop()})},y.getThumbUrl=function(e,t,i,r){var a,o;if(!i||isMobilePurchasePath()&&!isBotRequest)a=isMobilePurchasePath()?http_Scheme+"://"+requestHeader.http_GeoIpThumbsServer+"/thumbs/"+t:http_Scheme+"://"+requestHeader.http_GeoIpThumbsServer+"/thumbs/4/"+t;else{var m=y.getHybridServer();o=y.freeImageContributorType==freeImageContribType.Type2?"450vfree":imageHeader.isInDeCaptionExperiment&&"de"==e?"450vde":similarimageurl_folder,imageHeader.isIn1300Exp&&(m=y.getCompServer(r),o="360"==r?comp360imageurl_folder:compimageurl_folder),a=http_Scheme+"://"+m+"/"+o+"/"+t}return a},y.getHybridServer=function(){return isBotRequest?configSetting.BotImageHybridServer:requestHeader.http_GeoIpHybridServer},y.getCompServer=function(e){return"360"==e&&isBotRequest?configSetting.BotImageCompServer360:isBotRequest?configSetting.BotImageCompServer:configSetting.ImageCompServer},y.TrimValue=function(e,t){if(getSEOType(t)==SEOType.Type1&&0==getTruncateStatus(t))return e;for(var i=0,r=e.split(""),a=111;a<r.length;a++){switch(r[a]){case" ":case"-":case"_":i=a}if(99==a){i=65;break}if(i==a)break}return 0<i?e.substring(0,i):e},y.similarAltCaption=function(e,t){return"en"==http_Culture||"de"==http_Culture?e+" - "+ClientResources.StockPhotoNoTranslate:e+" "+ClientResources.StockPhotoNoTranslate},y.fireGoogletags=function(e){return setGoogleTags()},y.getHeight=function(e){var t=230,i=0;return y.thumbType==imageThumbType.HybridImages&&(t=f,i=getHybridImageHeight(e.PixelX,e.PixelY,t)),i},$(window).resize(function(){$(".image-brick img").removeAttr("height")});var f,T=!1;$(window).scroll(function(e){if(!y.isScrollDisabled()){var t=configSetting.hybridImageMaxCount;isMobilePurchasePath()&&!isBotRequest&&(t=configSetting.hybridImageMaxCountForMobileUsers);var i=$(window).scrollTop();$(".image-brick"),y.freeImageContributorType==freeImageContribType.Type2?y.freeThumbs().length:y.thumbs().length;if(i>parseInt($("#DivSimilarFreeImages .grid:last").css("top"))&&y.freeImageContributorType==freeImageContribType.Type2&&y.thumbType==imageThumbType.HybridImages&&!T&&y.freeThumbs().length<y.AllFreeImageCount&&y.freeThumbs().length<configSetting.hybridImageMaxCount&&(T=!0,$("#hyb-loader-freesimilar").css("display","block"),y.PageNumber=y.PageNumber+1,y.GetSimilars(y.thumbType,y.freeImageContributorType)),i>parseInt($("#DivHybridImages .grid:last").css("top"))&&y.freeImageContributorType==freeImageContribType.None&&y.thumbType==imageThumbType.HybridImages&&!T&&y.thumbs().length<y.AllImageCount&&y.thumbs().length<t){if(!isNextHybridPageExists)return;T=!0,$("#hyb-loader").css("display","block"),y.PageNumber=y.PageNumber+1,y.GetSimilars(y.thumbType,y.freeImageContributorType)}}}),y.handleImages=null,y.handleSimilarImages={setAllImageCount:function(e){y.AllImageCount=e-1},getImageRefs:function(){return similarImageRefs},pushtoImageRefs:function(e){$.each(e,function(e,t){similarImageRefs.push(t.ImageRef)})},getThumbsObject:function(){return y.thumbs},getcarouselContainer:function(){return $(".mobileviewnormal .mob-hybrid-google-swipe .image-brick")},getAllImageCount:function(){return y.AllImageCount}},y.handleFreeSimilarImages={setAllImageCount:function(e){y.AllFreeImageCount=e-1},getImageRefs:function(){return similarFreeImageRefs},pushtoImageRefs:function(e){$.each(e,function(e,t){similarFreeImageRefs.push(t.ImageRef)})},getThumbsObject:function(){return y.freeThumbs},getcarouselContainer:function(){return $(".mobileviewnormal .mob-hybrid-google-swipe-n-free .image-brick")},getAllImageCount:function(){return y.AllFreeImageCount}},y.isFreeImageComp=function(){return isFreeImageComp},y.GetSimilars=function(n,s){var e=compRequestParameters.imageRef,t=compRequestParameters.pseudoId,i=imageHeader.similarId,r=n==imageThumbType.HybridImages?imageHeader.queryTerms:compRequestParameters.searchKeyword,a=compRequestParameters.searchParameters,o=compRequestParameters.territoryId,m=compRequestParameters.collectionUrl,g=requestHeader.href,u=requestHeader.additionalUrl,l=alamyUser.isUserLoggedIn,h=configSetting.hybridImageCount,c=imageHeader.pictureType,d=imageHeader.seoPriority,p=imageHeader.ShowTranslatedCaption&&!isFreeImageComp?http_Culture:"en",b=3==n?1:n;n==imageThumbType.SameArtistImages&&y.isScrollDisabled(!0);var I='{ "similarRequest": '+('{ "ImageRef": "'+e+'", "PseudoId": "'+t+'", "SimilarGroupId": '+i+', "PageNumber": "'+y.PageNumber+'", "SearchKeyword": "'+r+'", "SearchString": "'+a+'", "TerritoryId": "'+o+'", "CollectionUrl": "'+m+'", "IsUserLoggedIn": '+l+', "ClientSideQuery": true, "Href": "'+g+'", "UrlPart": "'+u+'", "PictureType": "'+c+'", "SeoPriority": '+d+', "LangCode": "'+p+'", "ThumbType": "'+b+'", "FreeImageContributorType": '+s+"}")+"}";$.ajax({type:"POST",url:http_Or_Https_Path+"Mediacomp/ImageDetails.aspx/GetSimilars",cache:!1,data:I,contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){var r=e.d.Thumbs,t=e.d.ViewAllUrl,i=[];s==freeImageContribType.Type2?y.handleImages=y.handleFreeSimilarImages:y.handleImages=y.handleSimilarImages,n==imageThumbType.HybridImages&&0==r.length&&(isNextHybridPageExists=!1),0<e.d.AllImageCount&&(y.handleImages.setAllImageCount(e.d.AllImageCount),y.AllImageCount=e.d.AllImageCount-1);var a=n==imageThumbType.HybridImages?h:8;n==imageThumbType.SameArtistImages&&(a=20),n==imageThumbType.SimilarImages?$.each(sameImageRefs,function(e,i){a<=e||$.each(r,function(e,t){t.ImageRef==i&&$(this).remove()})}):(i=y.handleImages.getImageRefs(),$.each(i,function(e,i){a<=e||$.each(r,function(e,t){if(t.ImageRef==i)return r.splice(e,1),!1})})),r.length<=8&&(t=""),""!=t&&alamyUser.ShowAsPopup&&(t="Javascript:PopDown('"+t+"')");var o=$.map(r,function(e,t){return a<=t?null:e});n==imageThumbType.SimilarImages||n==imageThumbType.HybridImages?0==i.length&&$.each(o,function(e,t){i.push(t.ImageRef)}):n==imageThumbType.SamePhotographerImages&&0==sameImageRefs.length&&$.each(o,function(e,t){sameImageRefs.push(t.ImageRef)}),setTimeout(function(){$("#hyb-loader").css("display","none")},600),y.thumbType=n,y.freeImageContributorType=s,f=getHybridImageWidth();var m=y.handleImages.getThumbsObject();$.each(o,function(e,t){m.push({ImageId:t.ImageId,ImageRef:t.ImageRef,LangCode:t.LangCode,ImageSequence:t.ImageSequence,Caption:t.Caption,FilteredCaption:t.FilteredCaption,TrimmedCaption:t.TrimmedCaption,ImageUrl:t.ImageUrl,ImageLinkUrl:t.ImageLinkUrl,PixelX:t.PixelX,PixelY:t.PixelY,Width:f,Height:ko.observable(y.getHeight(t)),PicType:t.PicType})}),y.viewAllUrl(t),MoveImageSection(n),isMobilePurchasePath()||hideFooter(y.AllImageCount,y.thumbs().length,n),T=!1,(isFreeImageComp||n==imageThumbType.SameArtistImages)&&processMosaicView(),isMobilePurchasePath()||showimageBrick()},error:function(e){}})}};function objsetValues(e,t,i){e==imageThumbType.HybridImages&&("1"==t?objGTM.setValues("Similar Photos Click","HybridScrollPage"+t,i):objGTM.setValues("Similar Photos Click","HybridScrollPage"+t,""))}function hideFooter(e,t,i){i==imageThumbType.HybridImages&&(t<e&&t<=configSetting.hybridImageMaxCount?$("#footer_Normal").hide():$("#footer_Normal").show())}function isMobilePurchasePath(){return $("body").hasClass("mobileviewnormal")&&$(window).width()<768}function isHybIE(){var e=navigator.userAgent.toLowerCase();return-1!=e.indexOf("msie")&&parseInt(e.split("msie")[1])}var imgSecMoved,imgLoadCount=0;function showimageBrick(){$(".image-brick").prev(".loader").hide(),9<isHybIE()||!isHybIE()?$("body").removeClass("lte-ie9"):$("body").addClass("lte-ie9"),$(".image-brick").show(),$(".image-brick").masonry({itemSelector:".grid",transitionDuration:0}),$(".image-brick").masonry("reloadItems"),$(".image-brick").masonry("layout")}function resizeMouseOverPreview(e,t){if(!e.width||!e.height)return t;var i={width:e.width,height:e.height},r=e.width/e.height;return 1<r&&r>t.height/t.width?(i.width=t.height,i.height=t.height/r):(i.height=t.width,i.width=t.width*r),i.width=Math.round(i.width),i.height=Math.round(i.height),i}function getHybridImageWidth(){var e,t=230,i=$(".hybrid").width();return e=i<=400?2:i<=768?3:4,i&&(t=(i-4*e)/e),t}function getHybridImageHeight(e,t,i){var r;return r=t<=e?9:12,parseInt(i*(t/e))+r}function getHybridMarginBottom(e,t,i){var r=resizeMouseOverPreview({width:e,height:t},{width:300,height:450});return parseInt(-30*i/r.height)}function FormatHybridResults(){var i=getHybridImageWidth();$(".image-brick .grid").each(function(e,t){pixelX=t.attributes["data-pixelx"].value,pixelY=t.attributes["data-pixely"].value,height=getHybridImageHeight(pixelX,pixelY,i),marginBottom=getHybridMarginBottom(pixelX,pixelY,height),t.getElementsByClassName("brick_img")[0].style.height=height+"px",t.getElementsByClassName("brick_img")[0].style.marginBottom=marginBottom+"px"}),MoveImageSection(2)}function MoveImageSection(e){configSetting.isIntranet&&!imgSecMoved&&(e==imageThumbType.HybridImages&&$(".categorieslist").length?$("#IntranetHistory").length&&$("#IntranetHistory").insertBefore(".categorieslist"):$("#IntranetHistory").length&&$(".imagepopup").length&&$("#IntranetHistory").insertBefore($("#DivSimilarsImages")[0])),imgSecMoved=!0}function setGoogleTags(){return objGTM.setValues("Similar Photos Click","View Individual Photo",""),!0}isHybIE()<=9&&($(".image-brick").hide(),$(".image-brick").prev(".loader").show()),$(document).on("lazyloaded",function(e){if(!isMobilePurchasePath()){var t=0,i=$(".image-brick .grid img").length;$(".image-brick .grid img").load(function(){(t+=1)===i&&($(".image-brick").masonry({itemSelector:".grid",transitionDuration:0}),$(".image-brick").masonry("reloadItems"),$(".image-brick").masonry("layout"))}).each(function(){this.complete&&$(this).load()})}processMosaicView()});