var objSelUsage,objSelTerritory,objSelCountry,objSelIndustry,objSelMedia,objSelImageSize,objSelPrintRun,objSelInserts,objSelPlacement,objSelDuration,objTxtCountryFactor,objTxtCountry,objBtnAddtoCart,objBtnAddMAtoCart,objLnkAddtoCart,objBtnBuyNwCusPrice,objProcessCompletemsgCust,objSelStartingDay,objSelStartingMonth,objSelStartingYear,objTxtOtherIndustry,objSelAdditionalDetails,objLyPrice,popButtonId,gdiscountPrice,sLCountry,currencySymbol,licenseDateAlerted,GCurrecnyCode,GCountryCode,GCurrencySymbol,XCHANGE,m_TradPriceFactor,exchangeRate,finalprice=0,isGuest=0,isAccountPreApproved=0,noSpecialRegx=/^[^*|\":^~<>[\]{}`\\()';@$]+$/,basicDiscount="",aProdRestriction=[],baseprice="1",aWWUsageMediaList=new Array(8);aWWUsageMediaList[0]=new Array("99z","128"),aWWUsageMediaList[1]=new Array("99y","134"),aWWUsageMediaList[2]=new Array("2e","135"),aWWUsageMediaList[3]=new Array("2e","136"),aWWUsageMediaList[4]=new Array("99y","130"),aWWUsageMediaList[5]=new Array("2e","131"),aWWUsageMediaList[6]=new Array("2e","139"),aWWUsageMediaList[7]=new Array("2c","140");var arrExcludedUsageHighRisk=new Array(5);arrExcludedUsageHighRisk[0]=new Array("2f"),arrExcludedUsageHighRisk[1]=new Array("2a"),arrExcludedUsageHighRisk[2]=new Array("2b"),arrExcludedUsageHighRisk[3]=new Array("2c"),arrExcludedUsageHighRisk[4]=new Array("2d"),arrExcludedUsageHighRisk[5]=new Array("2g"),arrExcludedUsageHighRisk[6]=new Array("99y"),arrExcludedUsageHighRisk[7]=new Array("99z");var setTradPriceFactorAndExngRate=function(){if(GCurrecnyCode)for(var e=0;e<traditionalFactor.length;e++)if(traditionalFactor[e].Currency==GCurrecnyCode)return void(m_TradPriceFactor=traditionalFactor[e].PriceFactor)};$(document).ready(function(){GCurrecnyCode=alamyUser.currency.code,baseprice=imageHeader.basePrice,exchangeRate=alamyUser.currency.exchangeRate,basicDiscount=imageHeader.discount,setTradPriceFactorAndExngRate(),objLyPrice=$("#lyPrice"),objSelUsage=$("#selUsage"),objSelMedia=$("#selMedia"),objSelImageSize=$("#selImageSize"),objSelPrintRun=$("#selPrintRun"),objSelInserts=$("#selInserts"),objSelPlacement=$("#selPlacement"),objSelDuration=$("#selDuration"),objSelTerritory=$("#selTerritory"),objSelCountry=$("#selCountry"),objSelIndustry=$("#selIndustry"),objTxtCountryFactor=$("#txtCountryFactor"),objTxtCountry=$("#txtCountry"),objSelStartingDay=$(".selStartingDay"),objSelStartingMonth=$(".selStartingMonth"),objSelStartingYear=$(".selStartingYear"),objSelAdditionalDetails=$("#selAdditionalDetails"),objBtnAddtoCart=$("#btnAddtoCart"),objBtnAddMAtoCart=$("#btnMAAddtoCart"),1==alamyUser.IsNormalComp&&(objLnkAddtoCart=$("#lnkAddtoCart")),objBtnBuyNwCusPrice=$("#btnBuyNwCusPrice"),objProcessCompletemsgCust=$("#processCompletemsgCust"),objTxtOtherIndustry=$("#txtOtherIndustry"),"undefined"!=typeof isGuestUser&&isGuestUser&&(isGuest=1),"undefined"!=typeof isAccountAutoApproved&&isAccountAutoApproved&&(isAccountPreApproved=1),$("#formRMPricing .rmselect").change(function(e){"none"!=imageHeader.selectedLicenseType.toLowerCase()&&(AddtoCartExperiment?($("#btnBuyNwCusPrice").hide(),$("#btnBuyNwCusPrice_disabled").hide()):($("#btnBuyNwCusPrice").parent().hide(),$("#btnBuyNwCusPrice_disabled").parent().hide()),IsDisableAddButton?($("#viewcart_disabled").parent().hide(),$("#btnAddtoCart_disabled").parent().show(),$("#btnMAAddtoCart_disabled").parent().hide()):($("#viewcart").parent().hide(),$("#btnAddtoCart").parent().show(),$("#btnMAAddtoCart").parent().hide())),imageHeader.activeLicense=2,SelectPopularPrice(),"true"==isIntranetBespokeComp&&ClearBespokeSelection();var t=$(e.target);switch(t.attr("selectValue")&&SelectValue(t.attr("selectValue")),CalculatePrice(1),EnableAddtoCart(),EnableBuyNow(),changeFlowIcon(),t.attr("id").toLowerCase()){case"selusage":tagManagerSetVal("RMLicenseClick - Image Use");break;case"selmedia":tagManagerSetVal("RMLicenseClick - Details of Use"),ShowOtherIndustry();break;case"selindustry":ShowOtherIndustry();break;case"selstartingday":case"selstartingmonth":case"selstartingyear":licenseDateAlerted=!1}}),PopulateComboBox(objSelUsage[0],aU,"",2,0,0,"",ClientResources.ImageUse),PopulateComboBox(objSelTerritory[0],aT,0,2,0,3,"",ClientResources.Territory),PopulateComboBox(objSelIndustry[0],aInd,"",2,0,0,"",ClientResources.IndustrySector),imageHeader.isHighRiskEnabled&&0==configSetting.isIntranet&&rewriteUsage(),0==configSetting.isIntranet&&rewriteRestrictionUsage(),selectedLicense.startingYear&&"00000000-0000-0000-0000-000000000000"==imageHeader.licenseid&&!usTestIsActive&&(imageHeader.activeLicense=2,PopulaeComboboxFromDB(),changeFlowIcon(),EnableAddtoCart(),EnableBuyNow(),ShowOtherIndustry(),$("#collapseOne").addClass("in"),$("#collapsepanel").removeClass("collapsed"),SelectPopularPrice(),$("#icon1").addClass("rotate")),$("#collapsepanel").click(function(){0<this.outerHTML.indexOf("collapsed")?objGTM.setValues("RMLicenseClicks","Other Licence Dropdown Menu - Open",""):objGTM.setValues("RMLicenseClicks","Other Licence Dropdown Menu - Close",""),imageHeader.isHighRiskEnabled&&""!=imageHeader.licenseid&&(AddtoCartExperiment?($("#btnBuyNwCusPrice").hide(),$("#btnBuyNwCusPrice_disabled").hide()):($("#btnBuyNwCusPrice").parent().hide(),$("#btnBuyNwCusPrice_disabled").parent().hide()),$("#viewcart").parent().hide(),$("#btnAddtoCart").parent().show(),$("#btnMAAddtoCart").parent().hide())}),1==alamyUser.IsNormalComp&&(0<imageHeader.orderItemId.length&&("00000000-0000-0000-0000-000000000000"==imageHeader.licenseid&&"rm"!=imageHeader.selectedLicenseType.toLowerCase()||IsDisableBuyNowButton||IsDisableAddButton||($("#viewcart").parent().show(),$("#btnAddtoCart").parent().hide(),$("#btnMAAddtoCart").parent().hide(),AddtoCartExperiment&&($("#btnBuyNwCusPrice").hide(),$("#btnBuyNwCusPrice").parent().show()))),0==imageHeader.orderItemId.length&&($("#btnAddtoCart").parent().hide(),$("#btnAddtoCart_disabled").parent().hide(),$("#viewcart").parent().hide()))});var shref,QueryString,GetCurrencySperator=function(e){var t=".";switch(e){case"en":t=".";break;case"de":case"es":case"fr":case"it":case"pt":t=","}return t},PopulaeComboboxFromDB=function(){SetDropDownValue(objSelUsage,selectedLicense.usage),SelectValue(11),SetDropDownValue(objSelMedia,selectedLicense.media),SelectValue(10),SetDropDownValue(objSelImageSize,selectedLicense.imageSize),SetDropDownValue(objSelPrintRun,selectedLicense.printRun),SetDropDownValue(objSelInserts,selectedLicense.inserts),SetDropDownValue(objSelPlacement,selectedLicense.placement),101!=selectedLicense.startingYear&&(SetDropDownValue(objSelStartingDay,selectedLicense.startingDay),SetDropDownValue(objSelStartingMonth,selectedLicense.startingMonth),SetDropDownValue(objSelStartingYear,selectedLicense.startingYear)),SetDropDownValue(objSelDuration,selectedLicense.duration),SetDropDownValue(objSelIndustry,selectedLicense.industry),SetDropDownValue(objSelTerritory,SearchArray(aC,selectedLicense.country,0,3)),SearchArray(aC,selectedLicense.country,0,3)?(PopulateComboBox(objSelCountry[0],aC,SearchArray(aC,selectedLicense.country,0,3),2,0,3,"true",ClientResources.Country),SetDropDownValue(objSelCountry,selectedLicense.country)):(ClearComboBox(objSelCountry,"",ClientResources.Country),objSelCountry[0].selectedIndex=0),CalculatePrice(baseprice,!0)},BuyImageNow=function(){var e=HasrestrictionAvailable();if(1==configSetting.isIntranet&&0==e){null!=restrictionsDetails&&null!=restrictionsDetails||(restrictionsDetails="");var t=ClientResources.buyNowImageRestrictionText+restrictionsDetails;generateConfirmModal("Confirm",t,!0,!0,BuyImageComp,BuyCancel)}else BuyImageComp()},BuyCancel=function(){objBtnBuyNwCusPrice.removeClass("disabled")},BuyImageComp=function(){alamyUser.IsSingleAccountUser&&0==isAccountPreApproved&&!configSetting.isIntranet&&0==isGuest?$(this).ConfirmPasswordforBuynow(successfunction=BuyImageNowSuccess):BuyImageNowSuccess()},BuyImageNowSuccess=function(){if(2==imageHeader.activeLicense){var e,t=0,r=0;objBtnBuyNwCusPrice.off("click",BuyImageNow).addClass("disabled"),e=GetCookie("AlamyUserID"),0!=configSetting.isIntranet||e||(e=GetCookie("UID"))||(e=GetCookie("Session")),e?(t=ValidateOtherIndustry(),r=ValidateAddtnlDetails(objSelAdditionalDetails),"1"==t&&"1"==r?BuyNowPriceCalc():("0"==t?modalAlert(ClientResources.Alert,ClientResources.OtherIndustryValidationError):2==t&&(modalAlert(ClientResources.Alert,ClientResources.IndustryDetailsContainsInvalidCharacters),t=0),objBtnBuyNwCusPrice.on("click",BuyImageNow).removeClass("disabled"),objTxtOtherIndustry.focus())):window.location=configSetting.logonURL+"?returnurl="+escape(window.location.pathname)}},btnAddImageToCart=function(){popButtonId="btnAddtoCart",AddtoCartExperiment&&"none"!=$("#btnAddtoCartExperiment").css("display")&&(popButtonId="btnMAAddtoCart");var e=HasrestrictionAvailable();if(1==configSetting.isIntranet&&0==e){null!=restrictionsDetails&&null!=restrictionsDetails||(restrictionsDetails="");var t=ClientResources.buyNowImageRestrictionText+restrictionsDetails;generateConfirmModal("Confirm",t,!0,!0,AddImageToCart)}else AddImageToCart()},lnkAddImageToCart=function(){popButtonId="lnkAddtoCart",AddImageToCart()},AddImageToCart=function(){if(2==imageHeader.activeLicense){var e,t=0,r=0;1==alamyUser.IsNormalComp?$("#"+popButtonId).hasClass("version2addcart")?$("#"+popButtonId).off("click",lnkAddImageToCart).addClass("disabled"):$("#"+popButtonId).off("click",btnAddImageToCart).addClass("disabled"):(objBtnAddtoCart.off("click",AddImageToCart).addClass("disabled"),objBtnAddMAtoCart.off("click",AddImageToCart).addClass("disabled")),e=GetCookie("AlamyUserID"),0!=configSetting.isIntranet||e||(e=GetCookie("UID"))||(e=GetCookie("Session")),e?(t=ValidateOtherIndustry(),r=ValidateAddtnlDetails(objSelAdditionalDetails),"1"==t&&"1"==r?($("#"+popButtonId).hasClass("version2addcart")?(objGTM.setValues("Add","Add to Cart - Link",""),objLnkAddtoCart.removeClass("disabled").find("i").removeClass("icon-cart").addClass("icon-tick cyan")):(objGTM.setValues("Add","Add to Cart - CTA Button - Bottom",""),objBtnAddtoCart.removeClass("disabled").find("i").removeClass("icon-cart").addClass("icon-tick cyan"),objBtnAddMAtoCart.removeClass("disabled").find("i").removeClass("icon-cart").addClass("icon-tick cyan")),AddToCartPriceCalc()):("0"==t?modalAlert(ClientResources.Alert,ClientResources.OtherIndustryValidationError):2==t&&(modalAlert(ClientResources.Alert,ClientResources.IndustryDetailsContainsInvalidCharacters),t=0),$("#"+popButtonId).hasClass("version2addcart")?objLnkAddtoCart.on("click",lnkAddImageToCart).removeClass("disabled"):(objBtnAddtoCart.on("click",btnAddImageToCart).removeClass("disabled"),objBtnAddMAtoCart.on("click",btnAddImageToCart).removeClass("disabled")),objTxtOtherIndustry.focus())):window.location.href=configSetting.logonURL+"?returnurl="+escape(window.location.href)}},ValidateControl=function(e,t,r){return!(e.length<1)&&(e=e[0],!(t?""==e[e.selectedIndex].value:""==e[e.selectedIndex].value&&e[e.selectedIndex].text!=r)||(e.focus(),!1))},ValidateInput=function(){if(!ValidateControl(objSelUsage,!0,ClientResources.ImageUse))return!1;if(!ValidateControl(objSelMedia,!1,ClientResources.DetailsOfUse))return!1;if(!ValidateControl(objSelImageSize,!1,ClientResources.ImageSize))return!1;if(!ValidateControl(objSelPrintRun,!1,ClientResources.PrintRun))return!1;if(!ValidateControl(objSelInserts,!1,ClientResources.Inserts))return!1;if(!ValidateControl(objSelPlacement,!1,ClientResources.Placement))return!1;if(!ValidateControl(objSelDuration,!1,ClientResources.Duration))return!1;if(!ValidateControl(objSelTerritory,!1,ClientResources.Territory))return!1;if(!ValidateControl(objSelCountry,!0,ClientResources.Country))return!1;if("1"==SearchArray(aM,objSelMedia.val(),0,10)&&!ValidateControl(objSelIndustry,!0,ClientResources.IndustrySector))return!1;if(!ValidateNumericDate(objSelStartingDay.val(),objSelStartingMonth.val(),objSelStartingYear.val()))return modalAlert(ClientResources.Alert,ClientResources.InvalidStartingDate),!1;if(1==configSetting.isIntranet){if(!licenseDateAlerted&&"p"==GetDateRelativeToToday(objSelStartingDay.val(),objSelStartingMonth.val(),objSelStartingYear.val())&&(licenseDateAlerted=!0,!confirm(ClientResources.LicenceStartDateInPastConfirm)))return!1}else if("p"==GetDateRelativeToToday(objSelStartingDay.val(),objSelStartingMonth.val(),objSelStartingYear.val()))return modalAlert(ClientResources.Alert,ClientResources.LicenceStartDateCannotBeInPast),!1;return!0};function ResetRMDropdowns(){$("#selUsage").val()&&($("#selUsage").val(""),$("#selTerritory").val(""),$("#selIndustry").val(""),SelectValue(6),SelectValue(11),CalculatePrice(1),EnableAddtoCart(),EnableBuyNow(),changeFlowIcon())}function AddToCartPriceCalc(e){var t,r,o,a,i=new Date,n=(i.getFullYear(),i.getUTCDate(),i.getUTCMonth(),new Date);if(0<contribRestrictions.length&&0<aProdRestriction.length&&(null==e||!e))return $("#ModalRestriction").modal("show"),void $("#ModalRestContinueBtn").off("click").on("click",function(){$("#ModalRestriction").modal("hide"),AddToCartPriceCalc(!0)});0==configSetting.isIntranet&&objSelAdditionalDetails.val(""),r="DelStatus=1&imageid="+imageHeader.imageId+"&selUsage="+objSelUsage.val()+"&selMedia="+objSelMedia.val()+"&selImageSize="+objSelImageSize.val()+"&selPlacement="+objSelPlacement.val()+"&selStartingDay="+objSelStartingDay.val()+"&selStartingMonth="+objSelStartingMonth.val()+"&selStartingYear="+objSelStartingYear.val()+"&selDuration="+objSelDuration.val()+"&selTerritory="+objSelTerritory.val()+"&selCountry="+objSelCountry.val()+"&selIndustry="+objSelIndustry.val()+"&PricingCurrency="+GCurrecnyCode+"&txtCountry="+objSelCountry.val()+"&selPrintRun="+objSelPrintRun.val()+"&selInserts="+objSelInserts.val()+"&selAdditionalDetails="+encodeURIComponent($.trim(objSelAdditionalDetails.val()))+"&orderitemid="+imageHeader.orderItemId+"&orderid="+imageHeader.orderId+"&selotherIndustry="+encodeURIComponent($.trim(objTxtOtherIndustry.val().replace(/'/gi,"")))+"&LicenseType="+imageHeader.licenseType+"&bBuyable="+imageHeader.isBuyable+"&Imagestatus="+imageHeader.imageStatus+"&CollID=&imageType="+imageHeader.imageType+"&PictureType="+imageHeader.pictureType,o=imageHeader.getpicturetype(),a=""!=imageHeader.discount?gdiscountPrice:price;var s=[],l=1==imageHeader.imageType?"flipped":"original",d=1==imageHeader.imageType?imageHeader.flipImgRef:imageHeader.imageRef;s.push({name:"",id:d,price:a.toFixed(2).toString(),category:o,quantity:1,Currency:$.cookie("Currency"),dimension14:l,dimension22:img_Datetaken,dimension23:img_Dateuploaded,dimension24:img_x,dimension25:img_y,dimension26:img_orientation,dimension27:img_BandW,dimension28:img_cutout,dimension29:img_people,dimension30:img_license,dimension31:img_uploadtype,dimension32:img_pseudonym,dimension33:img_contributortype,dimension35:img_exclusivetoalamy,dimension36:img_priority}),SendAddToCartDataforGoogle(s),ValidateInput()?(t=configSetting.http_Path+"/Addtocart_popup.aspx?Timer="+n.getTime(),PostAjaxRequest(t,r,Success_AddToCart,Success_AddToCart,"POST")):$("#"+popButtonId).hasClass("version2addcart")?objLnkAddtoCart.on("click",lnkAddImageToCart).removeClass("disabled").find("i").addClass("icon-cart").removeClass("icon-tick cyan"):(objBtnAddtoCart.on("click",btnAddImageToCart).removeClass("disabled").find("i").addClass("icon-cart").removeClass("icon-tick cyan"),objBtnAddMAtoCart.on("click",btnAddImageToCart).removeClass("disabled").find("i").addClass("icon-cart").removeClass("icon-tick cyan"))}var BuyNowPriceCalc=function(e){1==alamyUser.IsNormalComp?objGTM.setValues("Download","Download - CTA Button",""):objGTM.setValues("Buy Now","Buy Now - CTA Button","");var t=new Date;if(0<contribRestrictions.length&&0<aProdRestriction.length&&(null==e||!e))return $("#ModalRestriction").modal("show"),void $("#ModalRestContinueBtn").off("click").on("click",function(){$("#ModalRestriction").modal("hide"),BuyNowPriceCalc(!0)});if(0==configSetting.isIntranet&&objSelAdditionalDetails.val(""),QueryString="DelStatus=1&imageid="+imageHeader.imageId+"&selUsage="+objSelUsage.val()+"&selMedia="+objSelMedia.val()+"&selImageSize="+objSelImageSize.val()+"&selPlacement="+objSelPlacement.val()+"&selStartingDay="+objSelStartingDay.val()+"&selStartingMonth="+objSelStartingMonth.val()+"&selStartingYear="+objSelStartingYear.val()+"&selDuration="+objSelDuration.val()+"&selTerritory="+objSelTerritory.val()+"&selCountry="+objSelCountry.val()+"&selIndustry="+objSelIndustry.val()+"&PricingCurrency="+GCurrecnyCode+"&txtCountry="+objSelCountry.val()+"&selPrintRun="+objSelPrintRun.val()+"&selInserts="+objSelInserts.val()+"&selAdditionalDetails="+encodeURIComponent($.trim(objSelAdditionalDetails.val()))+"&CrmHandler="+decodeURIComponent($.trim(CrmHandler))+"&orderitemid="+imageHeader.orderItemId+"&orderid="+imageHeader.orderId+"&selotherIndustry="+encodeURIComponent($.trim(objTxtOtherIndustry.val().replace(/'/gi,"")))+"&LicenseType="+imageHeader.licenseType+"&bBuyable="+imageHeader.isBuyable+"&Imagestatus="+imageHeader.imageStatus+"&CollID=&numOfAcc="+alamyUser.NumberOfAccounts+"&imageRef="+imageHeader.imageRef+"&optImageSize="+imageHeader.highestImageBin+"&isGuestUser="+isGuest+"&isAccountPreApproved="+isAccountPreApproved+"&imageType="+imageHeader.imageType+"&PictureType="+imageHeader.pictureType,ValidateInput()){shref=requestHeader.href+"CustomPrice-SetOrder.aspx?Timer="+t.getTime();alamyUser.userId,imageHeader.imageId;PostAjaxRequest(shref,QueryString,Success_BuyNowPriceCalc,failurefn,"POST")}else objBtnBuyNwCusPrice.on("click",BuyImageNow).removeClass("disabled")},ValidateOtherIndustry=function(){var e=0,t=$.trim(objTxtOtherIndustry.val());return 1==(e="D52"==objSelIndustry.val()&&t.length<5?0:1)&&""!=t&&(noSpecialRegx.test(t)||(e=2)),e},IsLicenseFixed=function(e,t,r,o,a,n,s,l){var d=0;for(i=0;i<aFixedPriceLic.length;i++){do{if(e==aFixedPriceLic[i][2]&&t==aFixedPriceLic[i][3]&&!(1<aFixedPriceLic[i][4].length&&l!=aFixedPriceLic[i][4])&&s==aFixedPriceLic[i][8]&&r==aFixedPriceLic[i][9]&&o==aFixedPriceLic[i][5]&&a==aFixedPriceLic[i][6]&&n==aFixedPriceLic[i][7]){d=aFixedPriceLic[i][1];break}}while(0);if(0<d)break}return d},CalculatePrice=function(e){if(finalprice=0,""==objSelUsage.val()&&!objSelUsage.is(":disabled")||""==objSelMedia.val()&&!objSelMedia.is(":disabled")||""==objSelImageSize.val()&&!objSelImageSize.is(":disabled")||""==objSelPrintRun.val()&&!objSelPrintRun.is(":disabled")||""==objSelInserts.val()&&!objSelInserts.is(":disabled")||""==objSelPlacement.val()&&!objSelPlacement.is(":disabled")||""==objSelDuration.val()&&!objSelDuration.is(":disabled")||""==objSelTerritory.val()&&!objSelTerritory.is(":disabled")||""==objSelCountry.val()&&!objSelCountry.is(":disabled")||""==objSelIndustry.val()&&!objSelIndustry.is(":disabled"))return DisplayPriceAndInternalLink(),!0;if(price=IsLicenseFixed(objSelUsage.val(),objSelMedia.val(),objSelImageSize.val(),objSelPrintRun.val(),objSelInserts.val(),objSelPlacement.val(),objSelDuration.val(),objSelCountry.val()),0<price)price=Math.round(price*exchangeRate*100)/100;else{var t=GDef(SearchArray(aU,objSelUsage.val(),0,1)),r=GDef(SearchArray(aM,objSelMedia.val(),0,2)),o=GDef(SearchArray(aI,objSelImageSize.val(),1,2)),a=GDef(SearchArray(aP,objSelPrintRun.val(),1,2)),i=GDef(SearchArray(aIns,objSelInserts.val(),0,1)),n=GDef(SearchArray(aPlace,objSelPlacement.val(),1,2)),s=GDef(SearchArray(aD,objSelDuration.val(),1,2));objTxtCountryFactor.val(GDef(SearchArray(aC,objSelCountry.val(),0,1)));var l,d=GDef(objTxtCountryFactor.val()),c=GDef(SearchArray(aInd,objSelIndustry.val(),0,1));0==(l=1.5*Math.abs(!1))&&(l=1),price=e*m_TradPriceFactor*r*t*o*a*i*n*s*d*c*l*exchangeRate;var u=0;u=.5<=100*price-Math.floor(100*price)?100*price+1:100*price,price=u/100,price=5*Math.ceil(price/5)}return"5"==imageHeader.pictureType&&(price=Math.round(price*configSetting.CustomPricefactor360*100)/100),0<price&&(finalprice=price),DisplayPriceAndInternalLink(price),!0},EnableAddtoCart=function(){var e;objProcessCompletemsgCust.hide(),objBtnAddtoCart.off("click",btnAddImageToCart).addClass("disabled"),objBtnAddMAtoCart.off("click",btnAddImageToCart).addClass("disabled"),""!=imageHeader.licenseid&&(AddtoCartExperiment?($("#btnBuyNwCusPrice").hide(),$("#btnBuyNwCusPrice_disabled").hide()):($("#btnBuyNwCusPrice").parent().hide(),$("#btnBuyNwCusPrice_disabled").parent().hide()),$("#viewcart").parent().hide(),$("#btnAddtoCart").parent().show(),$("#btnMAAddtoCart").parent().hide()),1==alamyUser.IsNormalComp&&objLnkAddtoCart.off("click",lnkAddImageToCart).addClass("disabled"),IsDisableAddButton?objBtnAddtoCart.attr("title",ClientResources.ThisImageIsNotForSale):0<finalprice?(0==(e=HasrestrictionAvailable())&&objProcessCompletemsgCust.show(),1==configSetting.isIntranet&&(e=1),0==e?(objBtnAddtoCart.attr("title",ClientResources.ImageRestrictedForSelectedLicenseSelectOther),objBtnAddMAtoCart.attr("title",ClientResources.ImageRestrictedForSelectedLicenseSelectOther)):(objBtnAddtoCart.attr("title",ClientResources.ClickHereToAddLicenseToCart),objBtnAddMAtoCart.attr("title",ClientResources.ClickHereToAddLicenseToCart),1==alamyUser.IsNormalComp&&objLnkAddtoCart.on("click",lnkAddImageToCart).removeClass("disabled"),objBtnAddtoCart.on("click",btnAddImageToCart).removeClass("disabled"),objBtnAddMAtoCart.on("click",btnAddImageToCart).removeClass("disabled"),"none"!=$("#viewcart").parent().css("display")&&($("#viewcart").parent().hide(),$("#btnAddtoCart").parent().show(),$("#btnAddMAtoCart").parent().show()),2==e&&ImageHasProductRestriction())):(objBtnAddtoCart.attr("title",ClientResources.SelectLicenseOptionsToAddToCart),objBtnAddMAtoCart.attr("title",ClientResources.SelectLicenseOptionsToAddToCart))},DisplayPriceAndInternalLink=function(e){var t,r="",o="";if(currencySymbol=SymbolFromCurrencyCode(GCurrecnyCode),null==e)o="";else if("HUF"==GCurrecnyCode){if(null!=vatRate&&0<e){var a=GetVatAddedPrice(e,vatRate);o=FormatNumber(a.toString(),2,1,",")}else o=FormatNumber(e.toString(),2,1,",");if("0"!=basicDiscount||""!=basicDiscount){if(t=e-e*basicDiscount/100,null!=vatRate&&0<t){var i=GetVatAddedPrice(t,vatRate);r=FormatNumber(i.toString(),2,1,",")}else r=FormatNumber(t.toString(),2,1,",");r=r+" "+currencySymbol}o=o+" "+currencySymbol}else if("NOK"==GCurrecnyCode||"SEK"==GCurrecnyCode||"ARS"==GCurrecnyCode||"CLP"==GCurrecnyCode){if(o=o+currencySymbol+" ",r=r+currencySymbol+" ",null!=vatRate&&0<e){a=GetVatAddedPrice(e,vatRate);o+=FormatNumber(a.toString(),2,1,",")}else o+=FormatNumber(e.toString(),2,1,",");if("0"!=basicDiscount||""!=basicDiscount)if(t=e-e*basicDiscount/100,null!=vatRate&&0<t){i=GetVatAddedPrice(t,vatRate);r+=FormatNumber(i.toString(),2,1,",")}else r+=FormatNumber(t.toString(),2,1,",")}else if("JPY"==GCurrecnyCode||"BRL"==GCurrecnyCode||"MXN"==GCurrecnyCode||"MYR"==GCurrecnyCode){if(o=o+currencySymbol+" ",r=r+currencySymbol+" ",null!=vatRate&&0<e){a=GetVatAddedPrice(e,vatRate);o+=FormatNumber(a.toString(),0,1,"")}else o+=FormatNumber(e.toString(),0,1,"");if("0"!=basicDiscount||""!=basicDiscount)if(t=e-e*basicDiscount/100,null!=vatRate&&0<t){i=GetVatAddedPrice(t,vatRate);r+=FormatNumber(i.toString(),0,1,"")}else r+=FormatNumber(t.toString(),0,1,"")}else{if(o=o+currencySymbol+" ",r=r+currencySymbol+" ",null!=vatRate&&0<e){a=GetVatAddedPrice(e,vatRate);o+=FormatNumber(a.toString(),2,1,GetCurrencySperator(http_Culture))}else o+=FormatNumber(e.toString(),2,1,GetCurrencySperator(http_Culture));if("0"!=basicDiscount||""!=basicDiscount)if(t=e-e*basicDiscount/100,null!=vatRate&&0<t){i=GetVatAddedPrice(t,vatRate);r+=FormatNumber(i.toString(),2,1,GetCurrencySperator(http_Culture))}else r+=FormatNumber(t.toString(),2,1,GetCurrencySperator(http_Culture))}gdiscountPrice=t,"0"==basicDiscount||""==basicDiscount?$("#lyPrice").html("<span>"+o+"</span>"):$("#lyPrice").html(r+"<br/><span><s>"+o+"</s></span>"),hasDownloadPacks&&(ClearPackSelection(),DisplayDownloadPackLink(!0))},EnableBuyNow=function(){if(objBtnBuyNwCusPrice.off("click",BuyImageNow).addClass("disabled"),IsDisableBuyNowButton)alamyUser.isDistributor&&requestHeader.isDistribUrl?objBtnBuyNwCusPrice.attr("title",ClientResources.PurchaseUsingDistributionSiteSuggestionMessage):objBtnBuyNwCusPrice.attr("title",ClientResources.ThisImageIsNotForSale);else if(0<finalprice){var e=HasrestrictionAvailable();0==e&&objProcessCompletemsgCust.show(),1==configSetting.isIntranet&&(e=1),0==e?objBtnBuyNwCusPrice.attr("title",ClientResources.ImageRestrictedForSelectedLicenseSelectOther):(objBtnBuyNwCusPrice.attr("title",ClientResources.ClickHereToBuyImage).on("click",BuyImageNow).removeClass("disabled"),2==e&&ImageHasProductRestriction())}else objBtnBuyNwCusPrice.attr("title",ClientResources.SelectLicenseOptionstoBuyTheImage)},changeFlowIcon=function(){var e=new Array(objSelUsage,objSelMedia,objSelImageSize,objSelPrintRun,objSelInserts,objSelPlacement,objSelDuration,objSelTerritory,objSelCountry,objSelIndustry);for(x=0;x<e.length;x++){var t=e[x],r=t.parent().parent().find(".pointer");0!=t[0].selectedIndex?r.removeClass("icon-arrow-pointed cyan").addClass("icon-tick green").show():1==t.find("option").length?r.addClass("icon-arrow-pointed cyan").removeClass("icon-tick green").hide():r.addClass("icon-arrow-pointed cyan").removeClass("icon-tick green").show()}},ShowOtherIndustry=function(){"D52"==objSelIndustry.val()?(objTxtOtherIndustry.focus().parent().parent().show(),$("#txtOtherIndustry").focus()):objTxtOtherIndustry.val("").parent().parent().hide()},ImageHasProductRestriction=function(){var e;for(e="<ul class='popup_rest_list_ul'>",i=0;i<aProdRestriction.length;i++)e+="<li class='popup_rest_list_li'>",e+=unescape(aProdRestriction[i][0]),aProdRestriction[i][0].indexOf("SensitiveSubindustryList")<0&&(e+=" - "),e+=unescape(aProdRestriction[i][1]),e+="</li>";e+="</ul>",$("#restrctionContent").html(ClientResources.RestrctionContent+e)},Restrictioningroup=function(e,t,r,o,a){var n=0;for(i=0;i<e.length;i++)if(e[i][r]==t&&e[i][o]==a)return n=1;return n},IfExistproductrest=function(e,t,r){for(i=0;i<e.length;++i)if(e[i][0].toString().toLowerCase()==t.toLowerCase()&&e[i][1].toString().toLowerCase()==r.toLowerCase())return!0;return!1},HasrestrictionAvailable=function(){var e,t,r=-(e=1),o="<a class='link_pddng' title ='"+ClientResources.ShowHideSensitiveIssues+"' href=javascript:toggle('SensitiveSubindustryList')>"+ClientResources.SensitiveIssues+"</a>",a='<div class="restri_senseissues" id="SensitiveSubindustryList" style ="display:none" name="SensitiveSubindustryList">'+SensitiveSubindustryList+"</div>";if(0<contribRestrictions.length)for(aProdRestriction=new Array,t=0;t<contribRestrictions.length;++t)if(!(null!=contribRestrictions[t].Country.Id&&contribRestrictions[t].Country.Id.toLowerCase()!=objSelCountry.val().toLowerCase()&&1!=Restrictioningroup(acg,objSelCountry.val().toLowerCase(),1,0,contribRestrictions[t].Country.Id.toLowerCase())&&1!=Restrictioningroup(acg,objSelCountry.val().toLowerCase(),0,1,contribRestrictions[t].Country.Id.toLowerCase())&&"ww"!=contribRestrictions[t].Country.Id.toLowerCase()&&"ww"!=objSelCountry.val().toLowerCase()||null!=contribRestrictions[t].Usage.Id&&contribRestrictions[t].Usage.Id.toLowerCase()!=objSelUsage.val().toLowerCase()||null!=contribRestrictions[t].Media.Id&&contribRestrictions[t].Media.Id.toLowerCase()!=objSelMedia.val().toLowerCase())){if(null==contribRestrictions[t].Industry.Id)return e=0;if(e=2,"d25"==contribRestrictions[t].Industry.Id.toLowerCase())0==IfExistproductrest(aProdRestriction,o,a)&&(aProdRestriction[r+=1]=new Array(2),aProdRestriction[r][0]=o,aProdRestriction[r][1]=a);else{var i=contribRestrictions[t].Industry.Description?contribRestrictions[t].Industry.Description:ClientResources.ALLIndustries,n=contribRestrictions[t].IndustryDetail.Description?contribRestrictions[t].IndustryDetail.Description:ClientResources.AllSubIndustries;0==IfExistproductrest(aProdRestriction,i,n)&&(aProdRestriction[r+=1]=new Array(2),aProdRestriction[r][0]=i,aProdRestriction[r][1]=n)}}return e},rewriteUsage=function(){for(var e=0;e<arrExcludedUsageHighRisk.length;e++)selectedLicense.usage!=arrExcludedUsageHighRisk[e]&&$("#selUsage option[value='"+arrExcludedUsageHighRisk[e]+"']").remove()},rewriteRestrictionUsage=function(){for(var e=0;e<contribRestrictions.length;e++)selectedLicense.usage!=contribRestrictions[e].Usage.Id&&$("#selUsage option[value='"+contribRestrictions[e].Usage.Id+"']").remove()},rewriteterritories=function(){var e,t;for(t=e=0;t<aWWUsageMediaList.length;t++)objSelUsage.val()==aWWUsageMediaList[t][0]&&objSelMedia.val()==aWWUsageMediaList[t][1]&&(e=1);var r="";0<objSelCountry[0].selectedIndex&&(r=objSelCountry.val()),sLCountry=r;var o=objSelTerritory.val();1==e?PopulateComboBox(objSelTerritory[0],aT,5,2,0,0,"",ClientResources.Territory):PopulateComboBox(objSelTerritory[0],aT,0,2,0,3,"",ClientResources.Territory),ClearComboBox(objSelCountry[0],"",ClientResources.Country),SetDropDownValue(objSelTerritory,o)&&""!=o?(""==SearchArray(aC,r,0,3)?PopulateComboBox(objSelCountry[0],aC,o,2,0,3,"true",ClientResources.Country):PopulateComboBox(objSelCountry[0],aC,SearchArray(aC,r,0,3),2,0,3,"true",ClientResources.Country),SetDropDownValue(objSelCountry,r)):(objSelTerritory[0].selectedIndex=0,ClearComboBox(objSelCountry[0],"",ClientResources.Country),objSelCountry[0].selectedIndex=0),2==objSelTerritory.find("option").length&&(objSelTerritory[0].selectedIndex=1,SelectValue(6))},SetDropDownValue=function(e,t){for(e=e[0],i=0;i<e.options.length;i++)if(e.options[i].value==t)return e.selectedIndex=i,!0;return!1},SetCountryInfo=function(){objTxtCountry.val(objSelCountry.val()),objTxtCountryFactor.val(GDef(SearchArray(aC,objSelCountry.val(),0,1)))},PopulateComboBox=function(e,t,r,o,a,n,s,l){var d,c=new Array,u=new Array,C=new Array(ClientResources.State,ClientResources.State,ClientResources.Country,ClientResources.Region,ClientResources.Region);for(ClearComboBox(e,"",l),d=1,i=0;i<t.length;i++)""!=r&&t[i][n]!=r||(u=new Array(t[i][o],t[i][a]),c[d++]=u);if(""!=s){objSelCountry.html("");var b=document.createElement("option");b.text=C[r-1],b.value="",document.getElementById("selCountry").options.add(b);for(var m=1;m<c.length;m++)""==c[m][1]?((b=document.createElement("option")).text=c[m][0],b.value=c[m][1],document.getElementById("selCountry").options.add(b),objTxtCountry.val(c[m][1]),objTxtCountryFactor.val(GDef(SearchArray(aC,c[m][1],0,1)))):((b=document.createElement("option")).text=c[m][0],b.value=c[m][1],document.getElementById("selCountry").options.add(b));objSelCountry.on("onchange",function(){SetCountryInfo()}),2==e.options.length?(e.selectedIndex=1,SetCountryInfo(),sLCountry=objSelCountry.val()):e.selectedIndex=0}else{e.options.length=c.length;for(m=1;m<c.length;m++)e.options[m].text=c[m][0],e.options[m].value=c[m][1],"selCountry"==e.name&&""==c[m][1]&&(objTxtCountry.val(sLCountry),objTxtCountryFactor.val(GDef(SearchArray(aC,c[m][1],0,1))),e.options[m].selected=!0);1==e.options.length&&ClearComboBox(e,"","defSelValue"),2==e.options.length?(e.selectedIndex=1,"selCountry"==e.name&&(sLCountry=e[e.selectedIndex].value,objTxtCountry.val(sLCountry),objTxtCountryFactor.val(GDef(SearchArray(aC,sLCountry,0,1))))):e.selectedIndex=0}return 1<e.options.length&&(e.disabled=!1),!0},SelectValue=function(e){if(10<e&&(""!=objSelUsage.val()?PopulateComboBox(objSelMedia[0],aM,objSelUsage.val(),3,0,1,"",ClientResources.DetailsOfUse):ClearComboBox(objSelMedia[0],"",ClientResources.DetailsOfUse)),9<e&&(""!=objSelMedia.val()&&""!=SearchArray(aM,objSelMedia.val(),0,5)?PopulateComboBox(objSelImageSize[0],aI,SearchArray(aM,objSelMedia.val(),0,5),3,1,0,"",ClientResources.ImageSize):ClearComboBox(objSelImageSize[0],"",ClientResources.ImageSize),""!=objSelMedia.val()&&""!=SearchArray(aM,objSelMedia.val(),0,6)?PopulateComboBox(objSelPrintRun[0],aP,SearchArray(aM,objSelMedia.val(),0,6),3,1,0,"",ClientResources.PrintRun):ClearComboBox(objSelPrintRun[0],"",ClientResources.PrintRun),""!=objSelMedia.val()&&"1"==SearchArray(aM,objSelMedia.val(),0,7)?PopulateComboBox(objSelInserts[0],aIns,"",2,0,0,"",ClientResources.Inserts):ClearComboBox(objSelInserts[0],"",ClientResources.Inserts),""!=objSelMedia.val()&&""!=SearchArray(aM,objSelMedia.val(),0,8)?PopulateComboBox(objSelPlacement[0],aPlace,SearchArray(aM,objSelMedia.val(),0,8),3,1,0,"",ClientResources.Placement):ClearComboBox(objSelPlacement[0],"",ClientResources.Placement),""!=objSelMedia.val()&&""!=SearchArray(aM,objSelMedia.val(),0,4)?PopulateComboBox(objSelDuration[0],aD,SearchArray(aM,objSelMedia.val(),0,4),3,1,0,"",ClientResources.Duration):ClearComboBox(objSelDuration[0],"",ClientResources.Duration),""!=objSelMedia.val()&&("1"==SearchArray(aM,objSelMedia.val(),0,10)?PopulateComboBox(objSelIndustry[0],aInd,"",2,0,0,"",ClientResources.IndustrySector):ClearComboBox(objSelIndustry[0],"",ClientResources.IndustrySector)),rewriteterritories()),5==e&&rewriteterritories(),6==e){var t=objSelTerritory.val();SetDropDownValue(objSelTerritory,t)&&""!=t?PopulateComboBox(objSelCountry[0],aC,t,2,0,3,"true",ClientResources.Country):(ClearComboBox(objSelCountry[0],"",ClientResources.Country),objSelCountry[0].selectedIndex=0)}return!0},ClearComboBox=function(e,t,r){return e.options.length=1,e.options[0].value=t,e.options[0].text=r,e.selectedIndex=0,e.disabled=!0},SearchArray=function(e,t,r,o){for(i=0;i<e.length;i++)if(e[i][r]==t)return e[i][o];return""},GDef=function(e){new Number;return""==e||isNaN(parseFloat(e.toString()))?1:parseFloat(e.toString())},loadNewStaticJS=function(){var e=["USD","GBP","EUR","AUD","INR","CAD"];for(var t in e)if(GCurrecnyCode==e[t]){for(var r in jsfile=configSetting.http_Path+"/scripts/inc-pricing-static-"+GCurrecnyCode+"-"+http_Culture+"-min.js?v=4",loadjscssfile(jsfile,"js"),e)GCurrecnyCode!=e[r]&&removejscssfile(configSetting.http_Path+"/scripts/inc-pricing-static-"+e[r]+"-"+http_Culture+"-min.js","js");break}},RMCurrencyChange=function(e){GCurrecnyCode=e,loadNewStaticJS(),setTradPriceFactorAndExngRate(),CalculatePrice("1")},Success_BuyNowPriceCalc=function(e){if(""!=e)if(xmlDoc=GetxmlHttpObject("<Root>"+e+"</Root>"),0==xmlDoc.getElementsByTagName("Order").length){var t,r,o,a,i;-1!=e.indexOf("|")&&(t=parseFloat(e.split("|")[1]),r=e.split("|")[2],o=e.split("|")[3],i=e.split("|")[4],a=e.split("|")[5],e=e.split("|")[0]),category=imageHeader.getpicturetype();$("input[type='radio'].optionsRadios:checked").parent().parent().parent().parent().attr("idx");var n,s,l=[];if(0!=xmlDoc.getElementsByTagName("Download").length){var d,c=xmlDoc.getElementsByTagName("Download");window.location.href=c[0].getAttribute("url"),""!=imageHeader.discount&&(price=discountPrice),d=price.toFixed(2);var u=1==imageHeader.imageType?"flipped":"original",C=1==imageHeader.imageType?imageHeader.flipImgRef:imageHeader.imageRef;"Images"==category?l.push({id:C,name:$("#selUsage option:selected").text(),category:category,price:d,quantity:1,dimension14:u,dimension22:img_Datetaken,dimension23:img_Dateuploaded,dimension24:img_x,dimension25:img_y,dimension26:img_orientation,dimension27:img_BandW,dimension28:img_cutout,dimension29:img_people,dimension30:img_license,dimension31:img_uploadtype,dimension32:img_pseudonym,dimension33:img_contributortype,dimension35:img_exclusivetoalamy,dimension36:img_priority}):l.push({id:C,name:$("#selUsage option:selected").text(),category:category,price:d,quantity:1,dimension22:img_Datetaken,dimension23:img_Dateuploaded,dimension24:img_x,dimension25:img_y,dimension26:img_orientation,dimension27:img_BandW,dimension28:img_cutout,dimension29:img_people,dimension30:img_license,dimension31:img_uploadtype,dimension32:img_pseudonym,dimension33:img_contributortype,dimension35:img_exclusivetoalamy,dimension36:img_priority}),dataLayer.push({event:"Ecommerce",ecommerce:{currencyCode:$.cookie("Currency"),purchase:{actionField:{id:r,revenue:(price+t).toFixed(2),tax:parseFloat(t).toFixed(2)},products:l}}}),GetLinkshareData(o,i,a)}else if(0!=xmlDoc.getElementsByTagName("OrderStatus").length){1==(n=xmlDoc.getElementsByTagName("OrderStatus")[0].getAttribute("iReasonCode"))?s=ClientResources.AccountOnHoldOrNotAuthorizedErrorMsg:2==n?s=ClientResources.PurchaseAmountExceededTheAccountCreditLimitMsg:3==n?s=ClientResources.AccountHasBeenClosedOrDeletedMsg:4==n&&(s=ClientResources.ErrorOccurredTryAgainLater),modalAlert(ClientResources.Sorry,s),objBtnBuyNwCusPrice.on("click",BuyImageNow).removeClass("disabled")}null!=opener?opener.RenderUserInfo():RenderUserInfo()}else{var b=xmlDoc.getElementsByTagName("Order")[0].getAttribute("OrderID");url=requestHeader.hrefSSL+"purchase/cust-order-confirm.aspx";var m=$('<form action="'+url+'" method="post" NAME=""frmConfirm""><input type="hidden" name="orderid" value="'+b+'" /></form>');alamyUser.ShowAsPopup?(window.opener?$("body",window.opener.document).append(m):$("body",window.parent.document).append(m),window.close()):$("body").append(m),$(m).submit()}else alamyUser.ShowAsPopup?(window.opener?window.opener.location.href=requestHeader.hrefSSL+"purchase/cust-order-confirm.aspx":window.parent.location.href=requestHeader.hrefSSL+"purchase/cust-order-confirm.aspx",window.close()):window.location.href=requestHeader.hrefSSL+"purchase/cust-order-confirm.aspx"},Success_AddToCart=function(e){selectedindex=0,""==e&&(1==alamyUser.IsNormalComp?(imageHeader.selectedLicenseType="RM",setTimeout(function(){$("#"+popButtonId).hasClass("version2addcart")?objLnkAddtoCart.on("click",lnkAddImageToCart).removeClass("disabled").blur().find("i").addClass("icon-cart").removeClass("icon-tick cyan"):(objBtnAddtoCart.on("click",btnAddImageToCart).removeClass("disabled").blur().find("i").addClass("icon-cart").removeClass("icon-tick cyan"),objBtnAddMAtoCart.on("click",btnAddImageToCart).removeClass("disabled").blur().find("i").addClass("icon-cart").removeClass("icon-tick cyan")),$("#viewcart").parent().show(),AddtoCartExperiment?($("#btnBuyNwCusPrice").hide(),$("#btnBuyNwCusPrice_disabled").hide()):($("#btnBuyNwCusPrice").parent().hide(),$("#btnBuyNwCusPrice_disabled").parent().hide()),$("#btnAddtoCart").parent().hide(),$("#btnAddtoCart_disabled").parent().hide(),$("#btnMAAddtoCart").parent().hide(),$("#btnMAAddtoCart_disabled").parent().hide()},0),"btnMAAddtoCart"==popButtonId&&(null!=opener?opener.RenderUserInfo():RenderUserInfo())):setTimeout(function(){objBtnAddtoCart.on("click",AddImageToCart).removeClass("disabled").blur().find("i").addClass("icon-cart").removeClass("icon-tick cyan"),objBtnAddMAtoCart.on("click",AddImageToCart).removeClass("disabled").blur().find("i").addClass("icon-cart").removeClass("icon-tick cyan")},5e3),0==$("#"+popButtonId).hasClass("btnversion2addcart")&&onAddToOrder())};