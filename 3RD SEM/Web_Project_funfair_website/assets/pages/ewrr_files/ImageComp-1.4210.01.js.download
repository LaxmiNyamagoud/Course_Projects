var showAllIndex, flagaddtodwnld = null, flagocd = null, flagbuy = null, downloadURL = "", freedownloadURL = "", TFCDownloadURL = "", IsContribRestriction = !1, WhichAddToCartButton = 0; function calcDimension(e, o, a, i) { var t = Math.min(a / e, i / o); return { width: e * t, height: o * t } } $(document).ready(function () { InitializeGTM(), $(".nobuy-nodwld").length > 0 || ($("#warningmsgs").removeClass("hidden"), $("#OptOutWarningMsgRM").removeClass("hidden")), $("body").on("click", "a.downloadpreview", function (e) { if (e.stopPropagation(), e.preventDefault(), "" == DownloadPreviewUrlPath) { var o = $("#imgPopup").attr("src"); window.location = configSetting.http_Path + "/thumbsImages.aspx?url=" + o + "&imageref=" + (1 == imageHeader.imageType ? imageHeader.flipImgRef : imageHeader.imageRef) } else window.location = configSetting.http_Path + "/thumbsImages.aspx?url=" + DownloadPreviewUrlPath + "&imageref=" + (1 == imageHeader.imageType ? imageHeader.flipImgRef : imageHeader.imageRef) }), $("body").on("click", ".lnk-tooltip-close", function (e) { return e.preventDefault(), $(this).closest(".popover").remove(), !1 }), $(".restrictions-link").on("click", function (e) { e.preventDefault(), goToByScroll($(this).attr("href")) }), $("#discount-btn").on("click", function () { setCookie("Ref", (1 == imageHeader.imageType ? imageHeader.flipImgRef : imageHeader.imageRef) + "||" + imageHeader.imageId, 365), objGTM.setValues("view discount button click", "AB test download pack view discount button click", ""); var e = $('<form action="/download-pack.aspx" method="post" name=""frmDownloadPack""><input type="hidden" name="PackageName" value="" /></form>'); $("body").append(e), $(e).submit() }), ImageComp(), downloadURL = configSetting.oCDUrl, freedownloadURL = configSetting.FreeOCDurl, configSetting.isIntranet && (alamyUser.NumberOfAccounts = 0), hasDownloadPacks && (1 == hasRestriction ? DisplayDownloadPackLink(!1) : DisplayDownloadPackLink(!0)); var e, o, a, i = GetCookie("Currency"); null != i && "undefined" != i && "" != i && alamyUser.currency.code != i && (alamyUser.currency.code = i, alamyUser.currency.symbol = GetCurrencySymbol(i), 1 == imageHeader.licenseType && 4 != imageHeader.pictureType && 5 != imageHeader.pictureType && UpdateRFPrice(i)), $("#currency").html(alamyUser.currency.code + " (" + alamyUser.currency.symbol + ")"), alamyUser.ShowAsPopup ? $(".view-cart-link").attr("href", "Javascript:PopDown('" + requestHeader.href + "order-view.aspx')") : $(".view-cart-link").attr("href", requestHeader.href + "order-view.aspx"), "none" != imageHeader.selectedLicenseType.toLowerCase() && ($("#collapsethree").addClass("in"), $("#collapsepanel3").removeClass("collapsed")), $("#collapsepanel").on("click", function (e) { if ($("#icon1").hasClass("rotate") ? $("#icon1").removeClass("rotate") : $("#icon1").addClass("rotate"), imageHeader.isHighRiskEnabled && !configSetting.isIntranet) $("#selUsage").val("2e").trigger("change"); else if (2 == $("#selUsage option").length && !configSetting.isIntranet) { var o = $($("#selUsage option")[1]).val(); $("#selUsage").val(o).trigger("change") } }), $("#collapsepanel2").on("click", function (e) { $("#icon1").hasClass("rotate") ? $("#icon1").removeClass("rotate") : $("#icon1").addClass("rotate") }), $(".collapse-panel-view").on("click", function (e) { $(this).find(".icon-arrow-down").hasClass("rotate") ? $(this).find(".icon-arrow-down").removeClass("rotate") : $(this).find(".icon-arrow-down").addClass("rotate") }), $("#ForgotPWTag").click(function () { var e = Hrefssl + "Logon.aspx?returnurl=" + encodeURIComponent(window.location.href) + "#forgotten-password"; window.open(e, "_blank") }), $("#btnDownload").click(function () { configSetting.isIntranet ? DownloadLibraryImage() : $(this).ConfirmPassword(successfunction = DownloadLibraryImage, downloadtype = "library"), objGTM.setValues("Download", "downloadyl", "") }), $("#IqDeletedimgWarningbtn").click(function () { configSetting.isIntranet ? DownloadLibraryImage() : ($("body").append('<div class="modal-backdrop  in"></div>'), $("#toPopup").addClass("show in")), objGTM.setValues("Download", "downloadyl", "") }), $("#IqDeletedbtnOk").click(function () { $(".closelink").click(), $(this).ConfirmPassword(successfunction = DownloadLibraryImage, downloadtype = "library") }), $(".closelink").click(function () { $(".modal-backdrop").remove(), $("#toPopup").removeClass("show in") }), $(".has-tooltip-top .icon-tool-tip-questionmark").popover({ placement: "top", html: "true" }), $(".restriction-msg .has-tooltip-bottom .icon-tool-tip-questionmark").popover({ placement: function (e, o) { return $(e).addClass("popover-custom-width"), "bottom" }, html: "true", container: "body" }), $(".has-tooltip .icon-tool-tip-questionmark").popover({ placement: "bottom", html: "true", container: "body" }), $(".icon-tool-tip-questionmark").on("click", function (e) { $(".icon-tool-tip-questionmark").not(this).popover("hide") }), $("#seeOriginal").click(function () { objGTM.setValues("imagecompaction", "OriginalimageBelowH1Click", "") }), $(".clsflip").on("click", function (e) { objGTM.setValues("imagecompaction", "FlippedimageClick", "") }), $(".need-print-holder,.file-size-dtls").hover(function () { $(this).find(".custom-tooltip-details").is(":visible") || $(".custom-tooltip-details").fadeOut("fast"), $(this).find(".custom-tooltip-details").fadeIn("fast"), clearTimeout(e) }, function () { e = setTimeout(function () { $(".custom-tooltip-details").fadeOut("fast") }, 300) }), $(".dl-remains").hover(function () { a = $(this).find(".dl-remains-content").width(), $(this).find(".dl-minute-details").is(":visible") || $(".dl-minute-details").hide(), $(this).find(".dl-minute-details").css("right", a - $(".dl-minute-details").width() / 2 + "px").fadeIn("fast"), clearTimeout(o) }, function () { a = "0", o = setTimeout(function () { $(".dl-minute-details").fadeOut("fast") }, 50) }); var t = $(location).attr("href"); function n(e) { if ("200" == e.status.code) { setCookie("Ref", (1 == imageHeader.imageType ? imageHeader.flipImgRef : imageHeader.imageRef) + "||" + imageHeader.imageId, 365); var o = requestHeader.hrefSSL + "purchase/cust-order-confirm.aspx"; window.location.href = o + "?fromPack=1" } else $("#btnBuyStudentPack").removeClass("disabled") } t = getPathFromUrl(t), $("#copyTheUrl").val(t), $(".dl-choose-another-lic-link").click(function () { $(".popular-lic-section").slideToggle(), $(".custom-lic-section").slideToggle() }), $("#copyToClipBoard").on("click", function () { if ("" != $("#copyTheUrl").val()) { $("#copyTheUrl").select(); try { document.execCommand("copy") } catch (e) { !1 } } }), showhidekeyword(), $("body").on("click", ".show-more-keywords", function () { $(".keywordlist").toggleClass("toggle-keywords"), $(".keywordlist").hasClass("toggle-keywords") ? ($(".show-more-keywords").html('<a id="automationShowAll" class="block">' + $(".show-more-keywords").data("show") + "</a>").insertBefore($(".sp-element-key")), $(".sp-element-key").addClass("show"), $(window).width() < 768 && $(".show-more-keywords").insertBefore(showAllIndex)) : ($(".show-more-keywords").html('<a class="block">' + $(".show-more-keywords").data("hide") + "</a>").appendTo($(".keywordlist")), $(".sp-element-key").removeClass("show")) }), $(".addthis_toolbox.share_link .dropdown-menu li a").hover(function () { $(".addthis_toolbox.share_link .dropdown-menu li a").removeClass("menuItemHover"), $(this).addClass("menuItemHover") }, function () { $(".addthis_toolbox.share_link .dropdown-menu li a").removeClass("menuItemHover") }), $(".snetwork").click(function () { objGTM1 = new GTM1, objGTM1.setValueswithCategory("Social Network Clicks", "Click - Footer", $(this).attr("id"), "") }), 0 == alamyUser.IsNormalComp && $("#OCDYourRefText").length > 0 && ($("#OCDYourRefText").on("keydown", function (e) { if (e.ctrlKey && 86 == e.keyCode) return !0; if (!(e.keyCode > 47 && e.keyCode < 91 || e.keyCode > 95 && e.keyCode < 112 || e.keyCode > 185 && e.keyCode < 223 || 13 == e.keyCode || 32 == e.keyCode)) return !0; var o = $(this).attr("maxlength"), a = $(this).val().length; return !(a >= o) || (a > o && modalAlert(ClientResources.Alert, ClientResources.CharacterMaximumLimitException), !1) }), $("#OCDYourRefText").on("paste", function (e) { if (window.clipboardData && clipboardData.getData) { var o = $(this).attr("maxlength"); return $(this).val().length + window.clipboardData.getData("text").length <= o || (modalAlert(ClientResources.Alert, ClientResources.CharacterMaximumLimitException), !1) } }), $("#OCDYourRefText").on("keyup", function (e) { var o = $(this).attr("maxlength"); $(this).val().length == o && modalAlert(ClientResources.Alert, ClientResources.CharacterMaximumLimitException) })), $(".contact").click(function () { $(this).css("visibility", "hidden"), $(".contact-deatils").css("visibility", "visible") }), $("#btnBuyStudentPack").click(function () { $(".loader").show(), $("#btnBuyStudentPack").addClass("disabled"); var e = { UserId: alamyUser.userId, PackageId: packageId, Exchangerate: alamyUser.currency.exchangeRate, PricingCurrency: currency }, o = serviceurl; $.post(o + "Commonfunctions.asmx/CreateDownloadpackOrder", e, n) }) }); var showhidekeyword = function () { var e = $(".keywordlist").parent().width() + 8; $(".show-more-keywords").html('<a  id="automationShowAll" class="block">' + $(".show-more-keywords").data("show") + "</a>"); var o = $(".show-more-keywords").outerWidth(!0) + 10; $(".keywordlist .mob-keyword-link").each(function () { if (o += $(this).outerWidth(!0), $(window).width() > 767) { if ($(".keywordlist .mob-keyword-link").removeClass("sp-element-key"), o > e) return $(this).addClass("sp-element-key show"), $(".show-more-keywords").insertBefore($(this)).show(), $(".keywordlist").addClass("toggle-keywords"), !1; $(this).removeClass("sp-element-key show"), $(".keywordlist").removeClass("toggle-keywords"), $(".show-more-keywords").hide() } else if (o >= 2 * $(window).width() - 60) return $(".keywordlist").addClass("toggle-keywords"), $(".show-more-keywords").insertBefore($(this).prev().prev()).show(), showAllIndex = $(this).prev().prev(), !1 }) }, win_width = $(window).width(); function goToByScroll(e) { $(window).width() < 767 ? $("html,body").animate({ scrollTop: $(e).offset().top - 18 }, "slow") : $("html,body").animate({ scrollTop: $(e).offset().top - 130 }, "slow") } function getPathFromUrl(e) { return e.split(/[&#]/)[0] } function DisplayDownloadPackLink(e) { hasCustomDownloadPacks || (1 == e && 0 == hasRestriction ? $(".save-with-dlPack").hasClass("show") || $(".save-with-dlPack").removeClass("hidden").addClass("show") : $(".save-with-dlPack").hasClass("hidden") || $(".save-with-dlPack").removeClass("show").addClass("hidden")) } $(window).resize(function () { showhidekeyword(), 1024 != $(window).width() && resizeCompImage() }), $(window).on("orientationchange", function () { showhidekeyword(), resizeCompImage() }); var tagManagerSetVal = function (e) { if (null == e || null == e) objGTM.setValues("Image Click", "previewimage", ""); else if ("RMLicenseClick - Image Use" != e && "RMLicenseClick - Details of Use" != e) { switch (e) { case "0": e = "XXL"; break; case "1": e = "XL"; break; case "2": e = "L"; break; case "3": e = "M"; break; case "4": e = "S"; break; case "5": e = "XS"; break; default: e = "XXL" } objGTM.setValues("RFSizeClick", e, "") } else if ("RMLicenseClick - Image Use" == e) { var o = document.getElementById("selUsage"), a = o.options[o.selectedIndex].text; "Image use" != a && objGTM.setValues("RMLicenseClick - Image Use", a, "") } else if ("RMLicenseClick - Details of Use" == e) { var i = document.getElementById("selMedia"), t = i.options[i.selectedIndex].text; objGTM.setValues("RMLicenseClick - Details of Use", t, "") } }, AddToLightboxPopup = function (e, o, a, i, t, n, l, s, d) { var r, c, m; if (objGTM.setValues("Add", "Add to Lightbox", ""), m = "&pid=" + i + "&pname=" + t + "&cid=" + n + "&name=" + l, $(".lightbox-new").removeClass("icon-lightbox").addClass("icon-tick cyan").removeClass("h16-size"), null == (r = GetCookie("AlamyUserID")) || "undefined" == r || "" == r) try { c = window.location.href.split("?")[0] + "?cmd=add2lb", c = AddURLParam(c += "&origin=id", "imageid", imageHeader.imageId), c = AddURLParam(c, "clbid", o), c = AddURLParam(c, "ref", s), c = AddURLParam(c, "lictype", d), c += m, c = escape(c), window.location.href = "/logon.aspx?returnurl=" + c } catch (e) { } else { var u, g = new Date, w = (new Date).getTime(); u = { imageid: imageHeader.imageId, clbid: o, t: g.getTime(), origin: "id", ref: s, licType: d, rnd: w, imageType: imageHeader.imageType }, PostAjaxRequest(requestHeader.href + "add-to-lightbox.asp", u, callBackFuncLightBoxSuccess, callBackFuncLightBoxFailure, "GET") } }, callBackFuncLightBoxSuccess = function (e) { setTimeout(function () { $(".lightbox-new").removeClass("icon-tick cyan").addClass("icon-lightbox").addClass("h16-size") }, 5e3) }, callBackFuncLightBoxFailure = function (e) { }, AddURLParam = function (e, o, a) { return -1 == e.toLowerCase().indexOf(o.toLowerCase()) ? e + "&" + o + "=" + a : e }, addToShoppingCart = function () { if (sUserId = GetCookie("AlamyUserID"), null != sUserId && "undefined" != sUserId && "" != sUserId || !configSetting.isIntranet) { var e, o = (new Date).getTime(); e = { imageid: imageHeader.imageId, collid: "", ref: imageHeader.imageRef, licType: imageHeader.licenseType, rnd: o, imageType: imageHeader.imageType }, PostAjaxRequest(requestHeader.href + "add-to-basket.asp", e, callBackFuncAddtoCartSuccess, callBackFuncAddtoCartFailure, "GET") } else { var a = configSetting.http_Path + "/MediaComp/ImageDetails.aspx?ref=" + imageHeader.imageRef; window.location.href = "/logon.aspx?imageid=" + imageHeader.imageId + "&collid=&cmd=add2basket&returnurl=" + a } }, callBackFuncAddtoCartSuccess = function () { var e; e = imageHeader.getpicturetype(); var o = GetCookie("Currency"), a = [], i = 1 == imageHeader.imageType ? "flipped" : "original", t = 1 == imageHeader.imageType ? imageHeader.flipImgRef : imageHeader.imageRef; a.push({ name: "", id: t, price: "", category: e, quantity: 1, Currency: o, dimension14: i, dimension22: img_Datetaken, dimension23: img_Dateuploaded, dimension24: img_x, dimension25: img_y, dimension26: img_orientation, dimension27: img_BandW, dimension28: img_cutout, dimension29: img_people, dimension30: img_license, dimension31: img_uploadtype, dimension32: img_pseudonym, dimension33: img_contributortype, dimension35: img_exclusivetoalamy, dimension36: img_priority }), SendAddToCartDataforGoogle(a), "True" == imageHeader.IsFreeImage && 1 == alamyUser.IsNormalComp || "1" == HidePriceOption ? ($(".Normal-AddCart").addClass("icon-tick cyan").removeClass("h16-size"), $("#lnkAddtoCart").addClass("disabled").off("click", addToShoppingCart)) : 2 == WhichAddToCartButton ? $(".Normal-AddCart").addClass("icon-tick cyan").removeClass("h16-size") : 1 == WhichAddToCartButton && $(".Normal-AddCart2").addClass("icon-tick cyan").removeClass("h16-size"), setTimeout(function () { try { null != opener ? opener.RenderUserInfo() : RenderUserInfo(), "True" == imageHeader.IsFreeImage && 1 == alamyUser.IsNormalComp || "1" == HidePriceOption ? ($(".Normal-AddCart").removeClass("icon-tick cyan").addClass("h16-size"), $("#lnkAddtoCart").removeClass("disabled").on("click", addToShoppingCart)) : 2 == WhichAddToCartButton ? $(".Normal-AddCart").removeClass("icon-tick cyan").addClass("h16-size") : 1 == WhichAddToCartButton && ($(".Normal-AddCart2").removeClass("icon-tick cyan").addClass("h16-size"), $(".AddToCartButton").blur()) } catch (e) { } }, 5e3) }, callBackFuncAddtoCartFailure = function () { }, EditImageClick = function () { var e, o; e = configSetting.http_Path + "/myupload/index.aspx?ref=" + imageHeader.imageRef, o = "en" == http_Culture ? window.open(e, "_blank") : window.open(e, "", void 0), window.focus && o.focus() }, addToShoppingCartV1 = function () { WhichAddToCartButton = 2, objGTM.setValues("Add", "Add to Cart - Link", ""), addToShoppingCart() }, ImageComp = function () { $(".AddToCartButton").click(function () { WhichAddToCartButton = 1, objGTM.setValues("Add", "Add to Cart - CTA Button - Top", ""), addToShoppingCart() }), $(".addcart").on("click", addToShoppingCartV1), $("#OCDDownload").click(function () { objGTM.setValues("Download", "Download - CTA Button", ""), OCDDownload(!1) }), $("#RFOCDDownload").click(function () { DownloadURLSet(imageHeader.licenseType), Download(!0) }), $("#OCDYourRef").click(function () { $(".errMsgParent").removeClass("has-error"), DownloadImage($("#OCDYourRefText").val()) }), $("#AlertOk").click(function () { $(".alert-modal-text").text(""), $("#AlertTitle").text(""), $("#AlertModal").modal("hide") }), $("#btnDelete").click(function () { var o = $("input:radio[name=deleteRadio]:checked").val(); if ("urgent" == o) e(o); else { if ("immediate" != o && "delayed" != o) return modalAlert(ClientResources.Alert, ClientResources.SelectAChoice), !1; $("#DeleteModalOk").unbind("click"), $("#DeleteModal").modal("show"), $("#DeleteModalOk").bind("click", function () { $("#DeleteModal").modal("hide"), e(o) }) } }); var e = function (e) { var i, t = !1, n = !1; if ("immediate" == e && (t = !0), "urgent" == e && (n = !0, t = !0), i = "UserId=" + alamyUser.userId + "&IsImmediate=" + t + "&IsPermanentDeletion=" + n + "&ImageIds=" + imageHeader.imageId, n) { var l = "ImageDeletion", s = "0"; if ($("#RadioUrgentLegal").is(":checked")) { l = "ImageDeletionLegal"; s = "1" } var d = "0"; "1" == $("#isFlippedImageHidden").val() && (d = "1"), i = i + "&UrgentDeletionType=" + s + "&ImageType=" + d, Permissionfordeleteimage(alamyUser.userId, requestHeader.href + "MediaComp/DataService/UrgentDelete.aspx?" + i, "write", l) } else i = "UserId=" + alamyUser.userId + "&ImageId=" + imageHeader.imageId + "&IsImmediate=" + t + "&IsPermanentDeletion=" + n, PostAjaxRequest(requestHeader.href + "MediaComp/DataService/Mediadelete.aspx", i, o, a, "POST") }, o = function (e) { "success" == e.toLowerCase() ? location.reload(!0) : modalAlert(ClientResources.Alert, ClientResources.DeletionFailed) }, a = function () { modalAlert(ClientResources.Alert, ClientResources.DeletionFailed) }; (contribRestrictions.length > 0 && !alamyUser.isBespokeUser || IsEditorialAndPersonalUseOnly && IsRF) && (IsContribRestriction = !0), $(".copyrightlink").click(function () { objGTM.setValues("Image Link Click", this.text, "") }), $(".Description-Link").click(function () { $(".DescriptionLink-Parent").addClass("hidden"), $(".Description-Item").removeClass("hidden"), objGTM.setValues("Click See Description in English", 1 == imageHeader.imageType ? imageHeader.flipImgRef : imageHeader.imageRef, "") }), $(".downloadpreview").click(function () { 1 == alamyUser.IsNormalComp ? objGTM.setValues("Download", "Save Preview Image Click", "") : objGTM.setValues("Download", "Download Preview Image Click", "") }), $(".Samephotographerviewall").click(function () { objGTM.setValues("Same Photographer Click", "View All Photos", "") }), $(".SimilarImageViewall").click(function () { objGTM.setValues("Similar Photos Click", "View All Photos", "") }), $(".viewAll a").click(function () { objGTM.setValues("imagecompaction", "SameImageClick", "") }), $(".SimilarImages1_RptSimilarImages_viewAll a").click(function () { objGTM.setValues("imagecompaction", "SimiliarImageClick", "") }), $(".keywordlist a").click(function () { objGTM.setValues("Keyword Click", this.innerText, "") }), $(".categorieslist a").click(function () { objGTM.setValues("imagecompaction", "CategoryClick", "") }), $(".stu-pack-read").click(function () { objGTM.setValues("Read more click", "StudentPackReadMoreClick", "") }), $(".stu-pack-read").hover(function () { objGTM.setValues("Read more Hover", "StudentPackReadMoreHover", "") }) }; function Permissionfordeleteimage(e, o, a, i) { var t, n; "write" == a && (t = "Permissions.asp?&finalpath=" + o), "read" == a && (t = "Permissions.asp?groupname=" + i + "&finalpath=" + o), n = HTTP_Path_Root + "/crm2/Permissions.asp?url=" + escape(t) + "&deletionflag=" + escape(!0) + "&groupname=" + escape(i); window.showModalDialog(n, "", "dialogWidth:550px; dialogHeight:100px; center:yes;"); location.reload(!0) } var PasswordVerify = function () { $(this).ConfirmPassword(successfunction = ImagePopUpFuncs, downloadtype = "image") }, PasswordVerifyforBuynow = function () { $(this).ConfirmPasswordforBuynow(successfunction = ImagePopUpFuncs) }, DownloadLibraryImage = function () { null != opener ? opener.RenderUserInfo() : RenderUserInfo(); var e; if (null != (e = GetCookie("AlamyUserID")) && null != e && "" != e) { var o = "userid=" + e + "&itemid=" + imageHeader.imageId; PostAjaxRequest(requestHeader.href + "MediaComp/DataService/LibraryDownload.aspx", o, LibrarySuccess, LibraryFailure, "POST") } }, LibrarySuccess = function (e) { "" != e && (window.location.href = e) }, LibraryFailure = function () { }, ImagePopUpFuncs = function () { if (alamyUser.isBespokeUser) { var e = GetCRMHandlerFrmCookie(); 1 == flagaddtodwnld ? isIQExtraDetailGroup && !IQExtraDetailModalBuyFlag ? IQExtraDetailmodeldialog() : (downloadURL += "?ID=" + imageHeader.imageId + "&bin=" + imageHeader.highestImageBin + "&LicType=" + imageHeader.licenseType + "&APA=1&CrmLogon=" + e + "&LangPath=" + configSetting.langPath + "/", downloadURL += AddOptRefValue(), downloadURL += AddCustIdValue(), downloadURL += AddIQExtraDetail(), ProcessDownload(), IQExtraDetailModalBuyFlag = !1) : 1 == flagbuy ? BespokeModalDialog() : 1 == flagocd && (isIQExtraDetailGroup && !IQExtraDetailModalBuyFlag ? IQExtraDetailmodeldialog() : (downloadURL += "?ID=" + imageHeader.imageId + "&bin=" + imageHeader.highestImageBin + "&LicType=" + imageHeader.licenseType + "&APA=1&CrmLogon=" + e + "&LangPath=" + configSetting.langPath + "/", downloadURL += AddOptRefValue(), downloadURL += AddCustIdValue(), downloadURL += AddIQExtraDetail(), ProcessDownload(), IQExtraDetailModalBuyFlag = !1)) } else ProcessDownload() }, PopDown = function (e) { var o = ""; "" != e && (o = e); try { (-1 != window.parent.location.href.indexOf("crm2/") || alamyUser.ShowAsPopup) && (-1 != o.indexOf("crm2/") || -1 != o.indexOf("finance/") || alamyUser.ShowAsPopup) ? alamyUser.ShowAsPopup ? (window.opener ? window.opener.location.href = o : window.parent.location.href = o, window.close()) : window.parent.location.href = o : window.location.href = o } catch (e) { window.location.href = o } }, Download = function (e) { return objGTM.setValues("Download", "Download - CTA Button", ""), imageHeader.isNews && -1 == downloadURL.indexOf("isNews") && (-1 == downloadURL.indexOf("?") ? downloadURL += "?isNews=1" : downloadURL += "&isNews=1"), "" != readCookie("AuthOCD") || configSetting.isIntranet ? "" == readCookie("AuthOCD") || configSetting.isIntranet ? void ProcessDownload() : (AuthOCDValidate("image"), !1) : (PasswordVerify(), !1) }, ProcessDownload = function () { return IsContribRestriction ? ($("#RestrictionModal").modal("show"), $("#RestrictionModalOk").off("click").on("click", function () { $("#RestrictionModal").modal("hide"), ProcessImageDownload() })) : ProcessImageDownload(), null != opener ? opener.RenderUserInfo() : RenderUserInfo(), !0 }, ProcessImageDownload = function () { return alamyUser.ocdMsgEnabled && !alamyUser.isBespokeUser ? (null != GetCookie("Pcomments2") && $("#OCDYourRefText").text(decodeURIComponent(GetCookie("Pcomments2"))), $("#myModal2").modal("show"), $("#myModal2").on("shown.bs.modal", function () { $("#OCDYourRefText").focus() })) : (isAvailableForDownload(), DisableDownload(!0)), !0 }, DisableDownload = function (e) { var o; o = 1 == flagaddtodwnld ? $("#Add2Downloads") : 1 == flagocd ? $("#BespokeOCDDownload") : 1 == flagbuy ? $("#btnBuyNwCusPrice") : $("#OCDDownload"), !1 === e ? (1 != flagaddtodwnld && 1 != flagocd && 1 != flagbuy && o.click(function () { DownloadURLSet(imageHeader.licenseType), Download(!1) }), o.removeClass("disabled")) : (1 != flagaddtodwnld && 1 != flagocd && 1 != flagbuy && o.unbind("click"), o.addClass("disabled"), setTimeout("DisableDownload(false);", 5e3)) }, DownloadImage = function (e) { "" == e ? ($(".errMsgParent").addClass("has-error"), $("#errMsg").html(ClientResources.PleaseEnterPurchaseOrderNoRefNo)) : e.length > 200 ? ($(".errMsgParent").addClass("has-error"), $("#errMsg").html(ClientResources.CommentsCannotExceed200Characters)) : /[!@~`^|<>{}"]/g.test(e) ? ($(".errMsgParent").addClass("has-error"), $("#errMsg").html(ClientResources.PleaseEnterValidReference)) : (setCookie("Pcomments2", e), -1 == downloadURL.indexOf("?") ? downloadURL += "?comments=" + e : downloadURL += "&comments=" + e, $("#myModal2").modal("hide"), imageHeader.isNews && -1 == downloadURL.indexOf("isNews") && (downloadURL += "&isNews=1"), isAvailableForDownload(), DisableDownload(!0)) }, isAvailableForDownload = function () { var e = (new Date).getTime(); -1 == downloadURL.indexOf("?") ? (downloadURL += "?isOCD=true", downloadURL += "&" + e) : (-1 == downloadURL.indexOf("isOCD") && (downloadURL += "&isOCD=true", ocdLogWrite && (downloadURL += "&ocdLogWrite=true&SearchID=" + ocdLogSID)), downloadURL += "&" + e), PostAjaxRequest(downloadURL, "", DownloadImageSuccess, DownloadImagefailure, "GET") }, FreeDownload = function () { var e = FreeDownloadURLSet(); PostAjaxRequest(e, "", DownloadImageSuccess, DownloadImagefailure, "GET"), DisableFreedownload(!0) }, DisableFreedownload = function (e) { $("#btnBuyNwCusPrice").addClass("disabled").off("click", BuyPopularPrice), 0 == e ? $("#btnBuyNwCusPrice").removeClass("disabled").on("click", BuyPopularPrice) : ($("#btnBuyNwCusPrice").addClass("disabled").off("click", BuyPopularPrice), setTimeout("DisableFreedownload(false);", 5e3)) }, DownloadImagefailure = function () { window.status = "failure" }, DownloadImageSuccess = function (e) { loadXML(e) }, loadXML = function (e) { var o = GetxmlHttpObject("<Root>" + e + "</Root>").getElementsByTagName("TFC"); if ($(o).attr("AvailableForDownload") && !$(o).attr("WarningMessage")) if (TFCDownloadURL = $(o).attr("DownloadURL"), null == flagaddtodwnld || null == flagaddtodwnld) { var a = getInternetExplorerVersion(); a > -1 && a <= 8 ? (modalAlert(ClientResources.Download, ClientResources.ThankYouYourDownloadWillBeginShortly), $("#AlertOk").bind("click", function () { DownloadImg(), $("#AlertTitle").text(""), $(".alert-modal-text").text(""), $("#AlertModal").modal("hide"), $("#AlertOk").click(function () { $("#AlertTitle").text(""), $(".alert-modal-text").text(""), $("#AlertModal").modal("hide") }) })) : DownloadImg() } else 1 == flagaddtodwnld && ($("#AddToDownloadsMsg").show(), setTimeout(function () { $("#AddToDownloadsMsg").hide() }, 5e3)); $(o).attr("WarningMessage") && modalAlert(ClientResources.Alert, $(o).attr("WarningMessage")) }, getInternetExplorerVersion = function () { var e = -1; if ("Microsoft Internet Explorer" == navigator.appName) { var o = navigator.userAgent; null != new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(o) && (e = parseFloat(RegExp.$1)), -1 != o.indexOf("Trident/5") && (e = 9) } return e }, GetxmlHttpObject = function (e) { return window.DOMParser ? (parser = new DOMParser, xmlDoc = parser.parseFromString(e, "text/xml")) : (xmlDoc = new ActiveXObject("Microsoft.XMLDOM"), xmlDoc.async = "false", xmlDoc.loadXML(e)), xmlDoc }, AuthOCDValidate = function (e) { $.post("/myalamycustomer.asmx/AuthOCDValidate", "downloadtype=" + e, AuthOCDValidateSuccess) }, AuthOCDValidateSuccess = function (e) { 200 == e.status.code ? ImagePopUpFuncs() : 1 == flagbuy ? PasswordVerifyforBuynow() : PasswordVerify() }, DownloadURLSet = function (e) { return downloadURL = configSetting.oCDUrl, downloadURL += "?ID=" + imageHeader.imageId + "&bin=" + imageHeader.highestImageBin + "&use=" + imageHeader.highestImageBin + "&SessionID=" + GetCookie("Session") + "&SearchMd5=&CrmLogon=" + GetCRMHandlerFrmCookie() + "&LicType=" + imageHeader.licenseType + "&LangPath=" + configSetting.langPath + "/", !0 }, FreeDownloadURLSet = function () { return downloadURL = configSetting.FreeOCDurl, downloadURL += "?ID=" + imageHeader.imageId + "&bin=" + imageHeader.highestImageBin + "&use=" + imageHeader.highestImageBin + "&SessionID=" + GetCookie("Session") + "&SearchMd5=&CrmLogon=" + GetCRMHandlerFrmCookie() + "&LicType=" + imageHeader.licenseType + "&FIT=" + imageHeader.FreeImageType + "&LangPath=" + configSetting.langPath + "/" }; function DownloadImg() { window.location.href = TFCDownloadURL } function GetCRMHandlerFrmCookie() { var e = GetCookie("Handler"); return null == e && (e = ""), e } function focusOn(e) { null != document.getElementById(e) ? scrollTo(0, getOffset(document.getElementById(e)).top) : scrollTo(0, getOffset(e).top) } function getOffset(e) { e || (e = this); for (var o = e.offsetLeft, a = e.offsetTop; e = e.offsetParent;) o += e.offsetLeft, a += e.offsetTop; return { left: o, top: a } } function InitializeGTM() { objGTM = new GTM("Image Page Interactions"), window.dataLayer = window.dataLayer || [], dataLayer.push({ available: IsImageAvailable, "unavailable-message": UnavailableMessage }) } $(window).bind("pageshow", function (e) { e.originalEvent.persisted && window.location.reload() }); var menuDisplayed = !1, menuBox = null; function renderPriceCalcExperiment() { IsRF || ($("#rm-custom-panel").hasClass("hidden") || $("#rm-custom-panel").addClass("hidden"), $(".custom-lic-section").hasClass("hidden") || $(".custom-lic-section").addClass("hidden")), $(document).find("#pricecalc-chat").length > 0 && ($(document).find("#pricecalc-chat").off("click"), $(document).on("click", "#pricecalc-chat", function () { $(".helpButtonEnabled").click() })) } window.addEventListener("contextmenu", function (e) { if ("imgPopup" == e.target.id || "pop-img" == e.target.id || "pano" == e.target.parentNode.parentNode.id) { var o = arguments[0].clientX, a = arguments[0].clientY; (menuBox = window.document.querySelector(".menu")).style.left = o + "px", menuBox.style.top = a + "px", menuBox.style.display = "block", arguments[0].preventDefault(), menuDisplayed = !0 } }, !1), window.addEventListener("click", function (e) { 1 == menuDisplayed && (menuBox.style.display = "none") }, !0), $("body").on("click", "#dlpreview", function () { $(".downloadpreview").click() }), $(window).on("scroll resize", function () { 1 == menuDisplayed && (menuBox.style.display = "none") });